(function(t,I){typeof exports=="object"&&typeof module<"u"?module.exports=I(require("react")):typeof define=="function"&&define.amd?define(["react"],I):(t=typeof globalThis<"u"?globalThis:t||self,t.MyReactLibrary=I(t.React))})(this,function(t){"use strict";const I=s=>{const[e,n]=t.useState(0),[o,a]=t.useState(!1),l=t.useRef(null),i=t.useCallback(()=>{l.current&&n(l.current.height)},[]);return t.useEffect(()=>{const f=()=>{a(!0),i()},d=l.current;return d&&(d.complete?f():d.addEventListener("load",f)),typeof window<"u"&&window.addEventListener("resize",i),()=>{d&&d.removeEventListener("load",f),typeof window<"u"&&window.removeEventListener("resize",i)}},[s,i]),[l,e,o]};class w{constructor(){this.observer=null,this.callbacks=new Map,this.visibilityStates=new Map}initializeObserver(){typeof window>"u"||this.observer||(this.observer=new IntersectionObserver(e=>{e.forEach(n=>{const o=n.target,a=this.callbacks.get(o),l=this.visibilityStates.get(o),i=n.isIntersecting;a&&l!==i&&(this.visibilityStates.set(o,i),a(i))})},{threshold:0,rootMargin:"16px"}))}static getInstance(){return w.instance||(w.instance=new w),w.instance}observe(e,n){this.initializeObserver(),this.observer&&(this.callbacks.set(e,n),this.visibilityStates.set(e,!1),this.observer.observe(e))}unobserve(e){this.callbacks.delete(e),this.visibilityStates.delete(e),this.observer&&this.observer.unobserve(e)}disconnect(){this.observer&&this.observer.disconnect(),this.callbacks.clear(),this.visibilityStates.clear()}}const x=w.getInstance(),V=()=>{const[s,e]=t.useState(!1),[n,o]=t.useState(!1),a=t.useRef(null),l=t.useRef();return t.useEffect(()=>{o(!0)},[]),t.useEffect(()=>{l.current=i=>{e(i)}}),t.useEffect(()=>{if(!n)return;const i=a.current;if(!(!i||!l.current))return x.observe(i,l.current),()=>{i&&(x.unobserve(i),x.disconnect())}},[n]),[a,s]};class b{constructor(){this.currentScrollY=0,this.isScrolling=!1,this.scrollTimeoutId=null,this.scrollingListener=null,this.handleScroll=()=>{typeof window>"u"||(this.currentScrollY=window.scrollY,this.isScrolling||(this.isScrolling=!0,this.notifyScrollingState(!0)),this.scrollTimeoutId!==null&&clearTimeout(this.scrollTimeoutId),this.scrollTimeoutId=window.setTimeout(()=>{this.isScrolling=!1,this.notifyScrollingState(!1)},100))},typeof window<"u"&&(window.addEventListener("scroll",this.handleScroll,{passive:!0}),this.currentScrollY=window.scrollY)}static getInstance(){return b.instance||(b.instance=new b),b.instance}notifyScrollingState(e){this.scrollingListener&&this.scrollingListener(e)}onScrollingChange(e){this.scrollingListener=e,e(this.isScrolling)}getScrollY(){return this.currentScrollY}}const C=b.getInstance();class E{constructor(){this.callbacks=new Set,this.animationFrameId=null,this.visibleElementsCount=0,this.isScrolling=!1,C.onScrollingChange(e=>{this.isScrolling=e,this.updateRAFState()})}static getInstance(){return E.instance||(E.instance=new E),E.instance}register(e){this.callbacks.add(e),this.visibleElementsCount++,this.updateRAFState()}unregister(e){this.callbacks.has(e)&&(this.callbacks.delete(e),this.visibleElementsCount=Math.max(0,this.visibleElementsCount-1),this.updateRAFState())}updateRAFState(){const e=this.isScrolling&&this.visibleElementsCount>0;e&&this.animationFrameId===null?this.startRAF():!e&&this.animationFrameId!==null&&this.stopRAF()}startRAF(){if(typeof window>"u")return;const e=()=>{this.callbacks.forEach(n=>n()),this.animationFrameId=requestAnimationFrame(e)};this.animationFrameId=requestAnimationFrame(e)}stopRAF(){typeof window<"u"&&this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}}const T=E.getInstance(),H=(s,e)=>s*e-s,Y=(s,e)=>Math.ceil(s/100*e-e/2),z=(s,e)=>{const{top:n,height:o}=s;let a=-o;const l=e;if(n<a)return 0;if(n>l)return 100;const i=(n-a)/(l-a)*100;return Math.round(Math.min(Math.max(i,0),100)*100)/100},P=(s,e)=>{switch(e){case"up":return`0, ${s}px, 0`;case"right":return`${-s}px, 0, 0`;case"down":return`0, ${-s}px, 0`;case"left":return`${s}px, 0, 0`;case"up left":return`${s}px, ${s}px, 0`;case"up right":return`${-s}px, ${s}px, 0`;case"down left":return`${s}px, ${-s}px, 0`;case"down right":return`${-s}px, ${-s}px, 0`;default:return`0, ${s}px, 0`}},N=()=>{const[s,e]=t.useState(null);return t.useEffect(()=>{const n=()=>{e(window.innerHeight)};if(typeof window<"u")return e(window.innerHeight),window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}},[]),s},j=({isLoaded:s,imageHeight:e,scale:n,boundingClientRect:o,orientation:a,maxTransition:l})=>{const[i,f]=t.useState(""),d=t.useRef({rangeMax:0,lastImageHeight:0,lastScale:0,lastTranslateValue:-999999,lastTransformString:""}),c=N();return t.useEffect(()=>{if(!s||!o||!c)return;const r=d.current;(r.lastImageHeight!==e||r.lastScale!==n)&&(r.rangeMax=H(e,n),r.lastImageHeight=e,r.lastScale=n);let h=z(o,c);l&&(h=Math.min(h,100-l));const m=Y(h,r.rangeMax);if(r.lastTranslateValue!==m){const g=P(m,a);g!==r.lastTransformString&&(r.lastTranslateValue=m,r.lastTransformString=g,f(g))}},[s,e,n,o,a,l,c]),i},q=()=>{const[s,e]=t.useState(!1);return t.useEffect(()=>{if(typeof window>"u")return;const n=window.matchMedia("(prefers-reduced-motion: reduce)");e(n.matches);const o=a=>{e(a.matches)};return n.addEventListener("change",o),()=>{n.removeEventListener("change",o)}},[]),s},B=({scale:s,overflow:e,delay:n,transition:o,orientation:a,maxTransition:l,isVisible:i,isLoaded:f,imageHeight:d,imageRef:c})=>{const[r,h]=t.useState(!1),[m,g]=t.useState(0),[$,F]=t.useState(null),[y,G]=t.useState(!1),u=q(),v=t.useCallback(()=>{var A;if(u||r&&!i)return;const p=C.getScrollY();if(r&&p===m)return;const S=(A=c.current)==null?void 0:A.getBoundingClientRect();S&&F(S),r||setTimeout(()=>{G(!0),h(!0)},50),g(p)},[u,i,r,m,c]),k=j({isLoaded:f,imageHeight:d,scale:s,boundingClientRect:$,orientation:a,maxTransition:l}),M=t.useCallback(p=>{if(!c.current||u||!p)return;let S=`translate3d(${p})`;e||(S+=` scale(${s})`),c.current.style.transform=S},[c,s,e,u]),L=t.useCallback(()=>{if(!c.current||u)return;const p=typeof navigator<"u"&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent),S=n>0&&!p?`all ${n}s ${o}`:"";c.current.style.transition=S},[c,n,o,u]);t.useEffect(()=>(i&&!u?T.register(v):T.unregister(v),()=>{T.unregister(v)}),[i,u,v]),t.useEffect(()=>{f&&c.current&&!u&&!r&&v()},[f,u,r,v]),t.useEffect(()=>{k&&(i||!r)&&(M(k),r||h(!0))},[k,i,r,M]),t.useEffect(()=>{!e&&f&&c.current&&!u&&(c.current.style.transform=`scale(${s})`)},[s,e,f,u]),t.useEffect(()=>{y&&L()},[y,L]),t.useEffect(()=>{u&&c.current&&(c.current.style.transform="",c.current.style.transition="")},[u])};var O="/Users/geoffrey/Desktop/perso/simpleParallax.js/src/react/index.tsx";return({delay:s=.4,orientation:e="up",scale:n=1.4,overflow:o=!1,transition:a="cubic-bezier(0,0,0,1)",maxTransition:l=null,children:i})=>{var y;const f=e??"up",d=n??1.2,c=(y=i==null?void 0:i.props)==null?void 0:y.src,[r,h,m]=I(c),[g,$]=V();B({scale:d,overflow:o,delay:s,transition:a,orientation:f,maxTransition:l,isVisible:$,isLoaded:m,imageHeight:h,imageRef:r});const F=t.isValidElement(i)?t.cloneElement(i,{ref:r}):null;return t.createElement("div",{ref:g,style:{overflow:o?"visible":"hidden"},__self:void 0,__source:{fileName:O,lineNumber:43,columnNumber:3}},F)}});
